Each trade depends on a number of MarketKeys being calculated first.
Each MarketKey may depend on other MarketKeys being calculated first.

The total time to calculate a trade is the sum of the trades's own calculation time plus the sum of all the calculation times of the MarketKeys the trade depends on (unless those keys have already been calculated within that batch).

If two or more trades within the same batch depend on the same MarketKey, then that key only needs to be calculated once for the first trade that requires it.

Subsequent trades that depend on the same MarketKey can use it without having to wait for it to be calculated again. This will reduce the calculation time of these trades.


The file trades.json contains the set of MarketKeys each trade depends on.
For example, trades.json contains information like:
 {
    "Uid": 100,
    "CalcSec": 4,
    "MarketKeys": [
      388,
      449
    ]
  }
which says that trade with Uid 100 takes 4 ms to calculate and depends on keys 338 and 449 to be calculated first.

The file marketkeys.json contains the set of MarketKeys each MarketKey depends on.
For example, marketkeys.json contains information like:
{
    "Uid": 10,
    "Dependencies": [
      6,
      7
    ],
    "CalcSec": 3
  }
which says that MarketKey with Uid 10 takes 3 ms to calculate and depends on MarketKeys 6 and 7 to be calculated first.

I would like you to use this information to modify the python script that determines how to group the trades into 64 batches such that the overall calculation time is minimised.

Please save the batch results into a json file with the same format as before.

